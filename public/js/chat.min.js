var msgBox=document.getElementById("msgBox");firebase.initializeApp(firebaseConfig),firebase.analytics(),firebase.auth().signInAnonymously().then(()=>{}).catch(e=>{console.error("Error while anonymous auth",e)});var query=firebase.firestore().collection("messages").orderBy("timestamp","asc").limit(20);function sendMsg(){var e=document.forms[0],t=e[2],s=e[1],e=e[0];s.setCustomValidity(""),t.setCustomValidity(""),50<s.value.length?(s.setCustomValidity("Your nick is too long!"),s.reportValidity()):500<t.value.length?(t.setCustomValidity("Your message is too long!"),t.reportValidity()):isNaN(e.value)?alert("There is something wrong. Please try again later"):(s={id:e.value,nick:s.value,message:t.value,timestamp:firebase.firestore.FieldValue.serverTimestamp()},firebase.firestore().collection("messages").add(s).catch(function(e){alert("There is something wrong. Please try again later")}),t.value="")}query.onSnapshot(function(e){e.docChanges().forEach(function(t){if("removed"===t.type)msgBox.removeChild(document.getElementById(t.doc.id)),msgBox.scrollTop=msgBox.scrollHeight;else{var s=t.doc.data();let e;e=idOfUser==s.id?"alert-danger ms-auto":"alert-primary me-auto",msgBox.innerHTML+='<div class="m-2 p-2 w-75 '+e+'" style="font-size: 1rem" id="'+t.doc.id+'"><b style="font-size: 1rem">'+s.nick+" at "+new Date(s.timestamp.toDate()).toUTCString()+' </b><hr class="m-0 p-0">'+s.message+"</div>",msgBox.scrollTop=msgBox.scrollHeight}})});