var msgBox=document.getElementById("msgBox");firebase.initializeApp(firebaseConfig),firebase.auth().signInAnonymously().then(()=>{}).catch(e=>{console.error("Error while anonymous auth",e)});var query=firebase.firestore().collection("messages").orderBy("timestamp","asc").limit(20);function sendMsg(){var e=document.forms[0];let t=e[2],s=e[1];e=e[0];s.setCustomValidity(""),t.setCustomValidity(""),50<s.value.length?(s.setCustomValidity("Your nick is too long!"),s.reportValidity()):500<t.value.length?(t.setCustomValidity("Your message is too long!"),t.reportValidity()):(e={id:e.value,nick:s.value,message:t.value,timestamp:firebase.firestore.FieldValue.serverTimestamp()},firebase.firestore().collection("messages").add(e).catch(function(e){alert("There is something wrong. Please try again later")}),t.value="")}query.onSnapshot(function(e){e.docChanges().forEach(function(s){if("removed"===s.type)msgBox.removeChild(document.getElementById(s.doc.id)),msgBox.scrollTop=msgBox.scrollHeight;else{var o=s.doc.data();let e;e=idOfUser==o.id?"alert-danger ms-auto":"alert-primary me-auto";let t=o.timestamp.toDate().toISOString().split("T");msgBox.innerHTML+='<div class="m-2 p-2 w-75 '+e+'" style="font-size: 1rem" id="'+s.doc.id+'"><b style="font-size: 1rem">'+o.nick+" at "+t[0]+" "+t[1].substring(0,5)+' </b><hr class="m-0 p-0">'+o.message+"</div>",msgBox.scrollTop=msgBox.scrollHeight}})});